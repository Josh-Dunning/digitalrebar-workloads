barclamp:
  name: kompos8
  display: Kubernetes Composed
  license: APLv2
  copyright: "RackN, 2016"
  os_support:
    - ubuntu-16.04
    - redhat-7.1

wizard:
  version: 2
  name: "Kompos8 K8s"
  description: "Install Kubernetes Cluster"
  icon: "group_work"
  system_nodes: false
  create_nodes: true
  os: true
  services:
    k8ubernetes-master: odd
    k8ubernetes-node: all
  create_size:
    default: "16 GB"
    AwsProvider: "m4.large"
    GoogleProvider: "n1-standard-16"
  deployment_size:
    k8ubernetes-master: 1
    k8ubernetes-node: 3

metadata:
  playbook_scope: deployment
  playbook_src_paths:
    k8: https://github.com/rackn/kompos8.git
  playbook_path: k8

roles:
  - name: k8ubernetes-master
    description: 'Kubernetes Master'
    icon: "grid_on"
    jig: noop
    flags:
      - milestone
    requires:
      - k8ubernetes-apiserver

  - name: k8ubernetes-node
    description: 'Kubernetes Node'
    jig: noop
    icon: "center_focus_strong"
    flags:
      - milestone
    requires:
      - k8ubernetes-worker

  - name: k8ubernetes-prereqs
    description: 'Kubernetes Setup'
    jig: ansible-playbook
    icon: "crop_free"
    flags:
      - implicit
    requires:
      - rebar-installed-node
    metadata:
      playbook_file: prereqs.yml

  - name: k8ubernetes-kubelet
    description: 'Kubernetes Kubelet'
    jig: ansible-playbook
    icon: "center_focus_weak"
    flags:
      - implicit
    requires:
      - k8ubernetes-prereqs
      - k8ubernetes-etcd
    metadata:
      playbook_file: kubelet.yml
    wants-attribs:
      - nics
      - use-proxy
      - proxy-servers

  - name: k8ubernetes-apiserver
    description: 'Kubernetes API Server'
    jig: ansible-playbook
    icon: "photo_filter"
    flags:
      - implicit
    requires:
      - k8ubernetes-kubelet
    metadata:
      playbook_file: apiserver.yml
    wants-attribs:
      - nics
      - use-proxy
      - proxy-servers

  - name: k8ubernetes-scheduler
    description: 'Kubernetes Scheduler'
    jig: ansible-playbook
    icon: "portrait"
    flags:
      - implicit
    requires:
      - k8ubernetes-kubelet
    metadata:
      playbook_file: scheduler.yml
    wants-attribs:
      - nics
      - use-proxy
      - proxy-servers

  - name: k8ubernetes-worker
    icon: "transform"
    description: 'Kubernetes Worker'
    jig: ansible-playbook
    flags:
      - implicit
    requires:
      - k8ubernetes-kubelet
      - k8ubernetes-apiserver
    metadata:
      playbook_file: worker.yml
    wants-attribs:
      - nics
      - use-proxy
      - proxy-servers
