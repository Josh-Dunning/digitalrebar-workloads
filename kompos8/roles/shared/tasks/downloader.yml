---

- name: "DEBUG: Version"
  debug: var=k8s.version
  when: debug

- name: "VAR: Strict Checksum"
  debug: var=k8s.strict
  when: debug

- name: "DEBUG: Version Staged"
  debug: var=k8s.version_stage

- name: "DEBUG: Version Passed from Caller"
  debug: var=kube_version

- name: "VAR: Download Source"
  debug: var=source.url
  when: debug

- name: "VAR: Component"
  debug: var=kube_component
  when: debug

- name: "VAR: Checksum"
  debug: var=source.checksum["{{ kube_version | default(k8s.version) }}"]["{{ kube_component }}"]
  when: debug

- name: "Download {{ kube_component }} {{ kube_version | default(k8s.version) }} Kubernetes Executable WITHOUT CHECKSUM [SLOW]"
  get_url:
    dest: "{{bin_dir}}/{{ kube_component }}"
    url: "{{ source.url }}/{{ kube_component }}"
    mode: 0755
  when: not k8s.strict and source.checksum["{{ kube_version | default(k8s.version)}}"][kube_component] is not defined

- name: "Download {{ kube_component}} {{ kube_version | default(k8s.version) }} Kubernetes Executables [SLOW]"
  get_url:
    dest: "{{bin_dir}}/{{ kube_component }}"
    checksum: "{{ item }}"
    url: "{{ source.url }}/{{ kube_component }}"
    validate_certs: yes
    mode: 0755
  with_items: "{{ vars['source']['checksum'][kube_version | default(k8s.version)][kube_component] }}"
  when: source.checksum["{{kube_version | default(k8s.version)}}"][kube_component] is defined and k8s.strict|default(true)
  ignore_errors: not k8s.strict|default(true)